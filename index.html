<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <style>
        .elemento {
            width: 30px;
            height: 30px;
            background-color: red;
        }

        .jugador {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: blue;
            border-radius: 100%;
        }

        #puntosCont {
            position: absolute;
        }

        #juego {
            position: absolute;
            width: 1000px;
            height: 500px;
            background-color: black;
            left: 25%;
            top: 300px;
        }
    </style>
    <div id="puntosCont">Puntuacion: <span id="puntos">0</span></div>
    <div id="juego">

        <div id="jugador" class="jugador"></div>
    </div>

    <script>
        let posicionJugador = { x: 100, y: 100 };
        juego = document.getElementById("juego")
        puntuacion = document.getElementById("puntos")
        puntos = 0;

        function crearElemento() {
            const elemento = document.createElement('div');
            elemento.classList.add('elemento');
            elemento.style.position = 'absolute';
            elemento.style.top = `${Math.random() * (juego.offsetHeight - 30)}px`;
            elemento.style.left = `${juego.offsetWidth - 30}px`;
            juego.appendChild(elemento);
            let borrado = false
            setInterval(() => {
                const left = parseFloat(elemento.style.left);
                if (elemento.offsetLeft == 0 && elemento) {
                    elemento.remove()
                    puntos -= 1
                    puntuacion.textContent = puntos
                    borrado = true
                } else {
                    elemento.style.left = `${left - 1}px`;
                }
            }, 1)
        }

        setInterval(crearElemento, 1000)

        moviendoW = false
        moviendoS = false
        moviendoA = false
        moviendoD = false

        document.addEventListener('keydown', (evento) => {
            switch (evento.key) {
                case 'w':
                    if (!moviendoW) {
                        moviendoW = true
                        intervaloW = setInterval(() => {
                            if (posicionJugador.y == 0) {
                                clearInterval(intervaloW)
                                moviendoW = false;
                                return
                            }
                            posicionJugador.y -= 1;
                        }, 2);
                    }
                    break;
                case 's':
                    if (!moviendoS) {
                        moviendoS = true
                        intervaloS = setInterval(() => {
                            if (posicionJugador.y == juego.offsetHeight - 10) {
                                clearInterval(intervaloS)
                                moviendoS = false;
                                return
                            }
                            posicionJugador.y += 1;
                        }, 2);
                    }
                    break;
                case 'a':
                    if (!moviendoA) {
                        moviendoA = true
                        intervaloA = setInterval(() => {
                            if (posicionJugador.x == 0) {
                                clearInterval(intervaloA)
                                moviendoA = false;
                                return
                            }
                            posicionJugador.x -= 1;
                        }, 2);
                    }
                    break;
                case 'd':
                    if (!moviendoD) {
                        moviendoD = true
                        intervaloD = setInterval(() => {
                            if (posicionJugador.x == juego.offsetWidth - 10) {
                                clearInterval(intervaloD)
                                moviendoD = false;
                                return
                            }
                            posicionJugador.x += 1;
                        }, 2);
                    }
                    break;
            }
        });

        document.addEventListener('keyup', (evento) => {
            switch (evento.key) {
                case 'w':
                    clearInterval(intervaloW);
                    moviendoW = false
                    break;
                case 's':
                    clearInterval(intervaloS);
                    moviendoS = false
                    break;
                case 'a':
                    clearInterval(intervaloA);
                    moviendoA = false
                    break;
                case 'd':
                    clearInterval(intervaloD);
                    moviendoD = false
                    break;


            }
        })
        function actualizarJugador() {
            const jugador = document.getElementById('jugador');
            jugador.style.left = `${posicionJugador.x}px`;
            jugador.style.top = `${posicionJugador.y}px`;
        }
        function animar() {
            // ...
            actualizarJugador();
            detectarColisiones();
            requestAnimationFrame(animar);
        }
        function detectarColisiones() {
            const jugador = document.getElementById('jugador');
            const radioJugador = jugador.offsetWidth / 2;
            const centroJugador = {
                x: posicionJugador.x + radioJugador,
                y: posicionJugador.y + radioJugador,
            };

            const elementos = document.querySelectorAll('.elemento');
            elementos.forEach((elemento) => {
                const radioElemento = elemento.offsetWidth / 2;
                const centroElemento = {
                    x: elemento.offsetLeft + radioElemento,
                    y: elemento.offsetTop + radioElemento,
                };

                const distancia = Math.sqrt(
                    Math.pow(centroJugador.x - centroElemento.x, 2) +
                    Math.pow(centroJugador.y - centroElemento.y, 2)
                );

                if (distancia < radioJugador + radioElemento) {
                    puntos += 1
                    puntuacion.textContent = puntos
                    elemento.remove();
                }
            });
        }
        animar()
    </script>
</body>

</html>